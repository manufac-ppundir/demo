name: Frontend CI/CD Workflow

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        default: 'main'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Setup Node.js environment
      uses: actions/setup-node@v2.1.3
    
    - name: Print OS info, Node & Yarn versions
      run: |
        uname -a
        node -v
        yarn -v

    - name: Build Frontend and Copy dist to the server
      env:
        PRIVATE_KEY: ${{ secrets.WORDPRESS_KEY }}
        HOST: ${{ secrets.WORDPRESS_HOST }}
        USER: ${{ secrets.WORDPRESS_USER }}
      run: |
        echo "$PRIVATE_KEY" > github-ec2.pem
        chmod 600 github-ec2.pem
        ssh -o StrictHostKeyChecking=no -i github-ec2.pem ${USER}@${HOST} '
            ls
            whoami
        '